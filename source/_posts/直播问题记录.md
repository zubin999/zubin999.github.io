---
title: 直播问题记录
date: 2022-03-31 16:13:56
tags:
---

- 体验版IM账号达到100个,需要删除账号小直播服务器数据库中账号和项目数据库中表中对应的记录

- 直播回顾生成
    1. 云直播中直播回顾创建一个hls模板
    2. 代码中开播会调用该模板设置录制任务
    3. 推流结束后,录制文件会存在云点播,录制回调中根据推流的类型(电台直播,视频直播等)调用不同的云点播任务流对录制文件转码为mp3和mp4
    4. 云点播回调根据file_id更新对应直播回顾,回顾生成完成
    5. 需注意直播录制回调时间根据直播录制模板中设置的续录等待时长而定,如设置600秒的续录等待时间,则断流10分钟后才会产生录制回调,中间有新推流,最终录制会合并为一个文件

- im回调中cmd值与表示:

|值|表示意义|
|----|-----------|
|1|文本消息|
|2|进入直播间|
|3|退出直播间|
|4|点赞|
|5|弹幕|
|6|连麦|
|10|打赏|
|11|红包|
|12|抢红包成功|
|13|发抽奖|
|14|图片消息|

- IM回调返回ErrorCode值说明:
    1. `0`表示下发消息,所有用户可看到消息
    2. `1`表示禁言,所有用户看不到消息
    3. `2`表示静默丢弃,所有用户看不到消息
    4. `10100`~`10200`之间,用户自定义错误信息,所有用户看不到消息

- 如果IM回调返回非0值,但是前端所有用户能正常收到消息,可能接口有报错,使用postman请求接口查看

- 创建直播间失败,日志显示:

```
Array
(
    [ActionStatus] => FAIL
    [ErrorCode] => 10036
    [ErrorInfo] => Fail to create AVchatroom. You've reached AVchatroom amount limit. Please upgrade your package on the console
)
```

体验版IM的AVChatroom数量上限是10个

- FM直播间hls录制回顾不生成

FM为纯音频流,要录制生成hls文件,需在腾讯云开启音视频探测服务,该服务默认是关闭的,可提工单开启

